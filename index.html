<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Cell Assessment Tool - ACN Solution Engineering</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { 
            font-family: 'Kanit', sans-serif; 
            background-color: #f8fafc; 
            font-size: 1.2rem; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
        }
        .card { transition: all 0.2s ease; cursor: pointer; border-width: 2px; }
        .card:hover { transform: translateY(-2px); border-color: #3b82f6; }
        .selected { border-color: #2563eb !important; background-color: #eff6ff !important; }
        .hidden { display: none; }
        .form-input {
            width: 100%; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 0.75rem; outline: none; font-size: 1.25rem;
        }
        .form-input:focus { border-color: #2563eb; }
        @media print { .no-print { display: none; } }
        
        /* Utility for 150% text boost */
        .text-boost-sm { font-size: 1.1rem; }
        .text-boost-md { font-size: 1.5rem; }
        .text-boost-lg { font-size: 1.8rem; }
        .text-boost-xl { font-size: 2.2rem; }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-12 no-print">
            <h1 class="text-boost-xl font-bold text-slate-800">ACN Solution Engineering</h1>
            <p class="text-boost-md text-slate-500 mt-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏ã‡∏•‡πà‡∏≤‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</p>
        </header>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-3 mb-12 no-print">
            <div id="progress" class="bg-blue-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>

        <div id="survey-container">
            <!-- Step 0: Customer Info -->
            <section id="step-0" class="step">
                <div class="bg-white rounded-2xl p-10 shadow-sm border border-gray-100">
                    <h2 class="text-boost-lg font-semibold mb-8 text-center">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <input type="text" id="cust-name" class="form-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• / ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó">
                        <input type="tel" id="cust-phone" class="form-input" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
                        <textarea id="cust-address" class="form-input md:col-span-2 h-24" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á"></textarea>
                    </div>
                    <button onclick="nextStep(1)" class="w-full bg-blue-600 text-white py-5 rounded-xl text-boost-md font-bold mt-8 shadow-lg">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
                </div>
            </section>

            <!-- Step 1: Electricity Bill -->
            <section id="step-1" class="step hidden">
                <h2 class="text-boost-lg font-semibold mb-8 text-center">1. ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 group-selection">
                    <div onclick="selectOption(this, () => setBill(3000, 1))" class="card p-8 bg-white rounded-xl shadow-sm text-center">
                        <div class="text-blue-600 font-bold text-boost-md">2,000 - 4,000 ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div onclick="selectOption(this, () => setBill(6000, 2))" class="card p-8 bg-white rounded-xl shadow-sm text-center">
                        <div class="text-blue-600 font-bold text-boost-md">4,001 - 8,000 ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div onclick="selectOption(this, () => setBill(12000, 3))" class="card p-8 bg-white rounded-xl shadow-sm text-center">
                        <div class="text-blue-600 font-bold text-boost-md">8,000 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</div>
                    </div>
                </div>
            </section>

            <!-- Step 2: Usage Time -->
            <section id="step-2" class="step hidden">
                <h2 class="text-boost-lg font-semibold mb-8 text-center">2. ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 group-selection">
                    <div onclick="selectOption(this, () => setUsageRatio(80))" class="card p-8 bg-white rounded-xl shadow-sm text-center">
                        <div class="font-bold text-boost-md">‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å</div>
                    </div>
                    <div onclick="selectOption(this, () => setUsageRatio(50))" class="card p-8 bg-white rounded-xl shadow-sm text-center">
                        <div class="font-bold text-boost-md">‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô</div>
                    </div>
                    <div onclick="selectOption(this, () => setUsageRatio(20))" class="card p-8 bg-white rounded-xl shadow-sm text-center">
                        <div class="font-bold text-boost-md">‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å</div>
                    </div>
                </div>
            </section>

            <!-- Step 3: Area Condition -->
            <section id="step-3" class="step hidden">
                <h2 class="text-boost-lg font-semibold mb-8 text-center">3. ‡∏™‡∏†‡∏≤‡∏û‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</h2>
                <div class="space-y-8">
                    <div class="group-selection">
                        <p class="mb-4 font-medium text-center text-boost-md">‡∏°‡∏µ‡πÄ‡∏á‡∏≤‡∏ö‡∏±‡∏á‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ/‡∏ï‡∏∂‡∏Å)</p>
                        <div class="grid grid-cols-2 gap-6">
                            <div onclick="selectOption(this, () => setShade(0))" class="card p-6 bg-white rounded-xl text-center text-boost-md">‡πÑ‡∏°‡πà‡∏°‡∏µ</div>
                            <div onclick="selectOption(this, () => setShade(1))" class="card p-6 bg-white rounded-xl text-center text-boost-md">‡∏°‡∏µ‡πÄ‡∏á‡∏≤‡∏ö‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏á</div>
                        </div>
                    </div>
                    <div class="group-selection">
                        <p class="mb-4 font-medium text-center text-boost-md">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</p>
                        <div class="grid grid-cols-2 gap-6">
                            <div onclick="selectOption(this, () => setOffgrid(0))" class="card p-6 bg-white rounded-xl text-center text-boost-md">‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏õ‡∏Å‡∏ï‡∏¥</div>
                            <div onclick="selectOption(this, () => setOffgrid(1))" class="card p-6 bg-white rounded-xl text-center text-boost-md">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤/‡πÑ‡∏ü‡∏ï‡∏Å‡∏ö‡πà‡∏≠‡∏¢</div>
                        </div>
                    </div>
                    <button onclick="nextStep(4)" class="w-full bg-blue-600 text-white py-5 rounded-xl text-boost-md font-bold shadow-lg">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
                </div>
            </section>

            <!-- Step 4: Priority -->
            <section id="step-4" class="step hidden">
                <h2 class="text-boost-lg font-semibold mb-8 text-center">4. ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h2>
                <div class="grid grid-cols-1 gap-6 group-selection">
                    <div onclick="selectOption(this, () => setPriority('ROI'))" class="card p-8 bg-white rounded-xl shadow-sm flex items-center gap-6">
                        <div class="bg-green-100 p-5 rounded-full text-green-600 font-bold text-2xl">‡∏ø</div>
                        <div>
                            <div class="font-bold text-boost-md">‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤ (ROI)</div>
                        </div>
                    </div>
                    <div onclick="selectOption(this, () => setPriority('SAFE'))" class="card p-8 bg-white rounded-xl shadow-sm flex items-center gap-6">
                        <div class="bg-blue-100 p-5 rounded-full text-blue-600 font-bold text-2xl">üõ°Ô∏è</div>
                        <div>
                            <div class="font-bold text-boost-md">‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</div>
                        </div>
                    </div>
                </div>
                <button onclick="calculateFinal()" class="w-full bg-blue-600 text-white py-5 rounded-xl text-boost-md font-bold mt-10 shadow-lg">‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
            </section>

            <!-- Result Section -->
            <section id="step-result" class="step hidden">
                <div id="capture-area" class="bg-white rounded-2xl p-10 md:p-14 shadow-2xl border border-gray-100 relative overflow-hidden">
                    <!-- Branding -->
                    <div class="flex justify-between items-center border-b-2 pb-6 mb-8">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-2xl shadow-inner">ACN</div>
                            <div>
                                <h2 class="text-boost-lg font-bold text-blue-800 uppercase leading-none">ACN Solution</h2>
                                <p class="text-boost-sm text-gray-400 font-light mt-1">Solar & Energy Professional</p>
                            </div>
                        </div>
                        <div class="text-right text-boost-sm text-gray-400" id="res-date"></div>
                    </div>

                    <!-- Client Info -->
                    <div class="mb-10 grid grid-cols-2 gap-6 text-boost-sm bg-slate-50 p-6 rounded-2xl border border-slate-100">
                        <p><span class="text-gray-400">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</span> <span id="res-name" class="font-bold text-slate-700"></span></p>
                        <p><span class="text-gray-400">‡πÇ‡∏ó‡∏£:</span> <span id="res-phone" class="font-bold text-slate-700"></span></p>
                        <p class="col-span-2"><span class="text-gray-400">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á:</span> <span id="res-addr" class="font-bold text-slate-700"></span></p>
                    </div>

                    <!-- Visual Section: Icons & Inverter Type -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                        <div id="source-display" class="bg-blue-50/50 p-8 rounded-3xl border-2 border-blue-100 flex flex-col items-center justify-center gap-4 text-center">
                            <div id="res-source-icons" class="flex items-center justify-center gap-4"></div>
                            <h3 id="res-sys-title" class="text-boost-lg font-bold text-blue-900 mt-2"></h3>
                        </div>
                        <div id="arch-display" class="bg-slate-50 p-8 rounded-3xl border-2 border-slate-100 flex flex-col items-center justify-center gap-4 text-center">
                            <div id="res-arch-icons" class="flex items-center justify-center gap-2"></div>
                            <p id="res-inv" class="text-boost-md font-bold text-slate-700 mt-2"></p>
                        </div>
                    </div>

                    <!-- Specification Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-10">
                        <div class="space-y-6">
                            <h4 class="font-bold text-slate-800 text-boost-md flex items-center gap-3 border-b-2 border-slate-100 pb-3">
                                üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö
                            </h4>
                            <div class="space-y-5">
                                <div class="flex justify-between items-center"><span class="text-boost-md">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡∏•‡∏¥‡∏ï</span> <span id="res-kwp" class="font-bold text-blue-800 text-boost-lg"></span></div>
                                <div class="flex justify-between items-center pt-2"><span class="text-boost-md">‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà</span> <span id="res-bat" class="font-bold text-blue-600"></span></div>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <h4 class="font-bold text-slate-800 text-boost-md flex items-center gap-3 border-b-2 border-slate-100 pb-3">
                                üí∞ ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
                            </h4>
                            <div class="bg-blue-600 text-white p-6 rounded-2xl text-center shadow-lg">
                                <p class="text-boost-sm opacity-80 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</p>
                                <p class="text-boost-sm">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà</p>
                                <p id="res-price-sys" class="text-boost-xl font-black"></p>
                                <p class="text-boost-sm mt-1">‡∏ö‡∏≤‡∏ó</p>
                            </div>
                        </div>
                    </div>

                    <!-- Reason Box -->
                    <div class="bg-slate-50 p-8 rounded-3xl mb-10 border border-slate-200">
                        <h4 class="font-bold text-slate-900 text-boost-md mb-6 flex items-center gap-3">üí° ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ</h4>
                        <ul id="res-logic" class="grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-6 text-boost-sm text-slate-600"></ul>
                    </div>

                    <!-- Footer -->
                    <div class="text-center pt-8 border-t-2 border-slate-100">
                        <p class="text-boost-md text-slate-600 mb-6 font-medium italic">" ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡∏ó‡πà‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏ü‡∏£‡∏µ "</p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center no-print">
                            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏ô‡∏¥‡πà‡∏á ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå) -->
                            <div class="bg-blue-600 text-white px-10 py-4 rounded-full text-boost-md font-bold shadow-xl flex items-center justify-center gap-2 cursor-default">
                                üìû 083-7504321
                            </div>
                            <a href="https://line.me/R/ti/p/@875vsdir" target="_blank" class="bg-[#00B900] text-white px-10 py-4 rounded-full text-boost-md font-bold shadow-xl hover:bg-[#009900] transition-all flex items-center justify-center gap-2">LINE @acnsolution</a>
                        </div>
                    </div>
                </div>

                <div class="mt-10 flex flex-col gap-4 no-print">
                    <button onclick="downloadAsImage()" class="w-full bg-slate-800 text-white py-6 rounded-2xl text-boost-md font-bold shadow-xl">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏≠‡πà‡∏≠‡∏ô -->
                    <button onclick="location.reload()" class="w-full bg-orange-100 text-orange-600 py-4 rounded-2xl text-boost-md font-semibold hover:bg-orange-200 transition-colors border border-orange-200 shadow-sm">
                        üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script>
        let state = { name: '', phone: '', address: '', bill: 0, billLevel: 1, dayRatio: 100, hasShade: false, isOffgrid: false, priority: 'ROI' };

        const ICONS = {
            grid: `<svg class="w-16 h-16 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M7 2v20M17 2v20M2 7h20M2 12h20M2 17h20" stroke-linecap="round"/></svg>`,
            battery: `<svg class="w-16 h-16 text-orange-500" viewBox="0 0 24 24" fill="currentColor"><path d="M20 7h-2V5c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM8 5h8v2H8V5zm4 11h-2v2H8v-2H6v-2h2v-2h2v2h2v2zm7-2h-4v-2h4v2z"/></svg>`,
            plus: `<span class="text-2xl font-bold text-slate-300">+</span>`,
            string: `<div class="flex items-center gap-2">
                        <div class="flex flex-col gap-1"><div class="w-8 h-10 bg-blue-100 border border-blue-400 rounded"></div><div class="w-8 h-10 bg-blue-100 border border-blue-400 rounded"></div></div>
                        <div class="text-slate-300">‚ûî</div>
                        <div class="w-12 h-16 bg-slate-700 rounded flex items-center justify-center text-[8px] text-white text-center p-1">String Inverter</div>
                     </div>`,
            micro: `<div class="flex items-center gap-2">
                        <div class="flex flex-col gap-1">
                            <div class="flex items-center gap-1"><div class="w-8 h-8 bg-blue-100 border border-blue-400 rounded"></div><div class="w-4 h-4 bg-slate-600 rounded"></div></div>
                            <div class="flex items-center gap-1"><div class="w-8 h-8 bg-blue-100 border border-blue-400 rounded"></div><div class="w-4 h-4 bg-slate-600 rounded"></div></div>
                        </div>
                        <div class="text-slate-300">‚ûî</div>
                        <div class="text-boost-sm font-bold text-slate-500">Microinverter</div>
                    </div>`
        };

        function nextStep(n) {
            if (n === 1) {
                state.name = document.getElementById('cust-name').value;
                state.phone = document.getElementById('cust-phone').value;
                state.address = document.getElementById('cust-address').value;
                if (!state.name || !state.phone) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£'); return; }
            }
            showStep(n);
        }

        function showStep(n) {
            document.querySelectorAll('.step').forEach(s => s.classList.add('hidden'));
            const el = document.getElementById('step-' + (isNaN(n) ? n : n));
            if(el) el.classList.remove('hidden');
            if(!isNaN(n)) document.getElementById('progress').style.width = (n * 25) + '%';
        }

        function selectOption(el, action) {
            el.closest('.group-selection').querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            setTimeout(action, 200);
        }

        function setBill(b, l) { state.bill = b; state.billLevel = l; nextStep(2); }
        function setUsageRatio(r) { state.dayRatio = r; nextStep(3); }
        function setShade(v) { state.hasShade = !!v; }
        function setOffgrid(v) { state.isOffgrid = !!v; }
        function setPriority(p) { state.priority = p; }

        function calculateFinal() {
            const needsBattery = state.isOffgrid || state.dayRatio < 60;
            const useMicro = (state.hasShade || state.priority === 'SAFE') && !state.isOffgrid;
            
            let systemTitle = "";
            let inv = "";
            let batText = "‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà";
            let startPrice = state.billLevel === 1 ? 125000 : (state.billLevel === 2 ? 185000 : 350000);
            if (useMicro) startPrice += (startPrice * 0.2);

            let sourceHtml = "";
            if (state.isOffgrid) {
                systemTitle = "Off-Grid System";
                sourceHtml = ICONS.battery;
                batText = "‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà";
            } else if (needsBattery) {
                systemTitle = "Hybrid Solar System";
                sourceHtml = ICONS.grid + ICONS.plus + ICONS.battery;
                batText = "‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà";
            } else {
                systemTitle = "On-Grid System";
                sourceHtml = ICONS.grid;
            }

            let archHtml = useMicro ? ICONS.micro : ICONS.string;
            inv = useMicro ? "‡∏£‡∏∞‡∏ö‡∏ö Microinverter (Rapid Shutdown)" : "‡∏£‡∏∞‡∏ö‡∏ö String Inverter";

            let logic = [
                { title: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ", text: "‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏á‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå Tier 1 ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÇ‡∏•‡∏Å ‡πÅ‡∏•‡∏∞ Inverter ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏´‡∏•‡∏ß‡∏á/‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ" },
                { title: "‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û", text: useMicro ? "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏¢‡∏Å‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏£‡∏≤‡∏¢‡πÅ‡∏ú‡∏á ‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏°‡πâ‡∏°‡∏µ‡πÄ‡∏á‡∏≤‡∏ö‡∏±‡∏á ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏¢‡∏∑‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏ú‡∏á" : "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏î‡∏î‡∏à‡∏±‡∏î ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß" },
                { title: "‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤", text: useMicro ? "‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 25 ‡∏õ‡∏µ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡πÅ‡∏ú‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" : "‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢ ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡πÅ‡∏û‡∏£‡πà‡∏´‡∏•‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö Monitoring ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£" },
                { title: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤", text: useMicro ? "‡πÅ‡∏°‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ 15-20% ‡πÅ‡∏ï‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï" : "‡πÄ‡∏ô‡πâ‡∏ô‡∏à‡∏∏‡∏î‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (ROI) ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÉ‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î" }
            ];

            document.getElementById('res-name').innerText = state.name;
            document.getElementById('res-phone').innerText = state.phone;
            document.getElementById('res-addr').innerText = state.address || '-';
            document.getElementById('res-date').innerText = "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠: " + new Date().toLocaleDateString('th-TH');
            document.getElementById('res-sys-title').innerText = systemTitle;
            document.getElementById('res-source-icons').innerHTML = sourceHtml;
            document.getElementById('res-arch-icons').innerHTML = archHtml;
            document.getElementById('res-inv').innerText = inv;
            document.getElementById('res-kwp').innerText = state.billLevel === 1 ? "3.3 kWp" : (state.billLevel === 2 ? "5 kWp" : "10 kWp");
            document.getElementById('res-bat').innerText = batText;
            document.getElementById('res-price-sys').innerText = startPrice.toLocaleString();
            
            const logicList = document.getElementById('res-logic');
            logicList.innerHTML = "";
            logic.forEach(item => {
                const li = document.createElement('li');
                li.className = "flex flex-col gap-1";
                li.innerHTML = `<span class="font-bold text-slate-800">‚úÖ ${item.title}:</span> <span class="leading-relaxed">${item.text}</span>`;
                logicList.appendChild(li);
            });

            showStep('result');
        }

        async function downloadAsImage() {
            const area = document.getElementById('capture-area');
            const canvas = await html2canvas(area, { scale: 2 });
            const link = document.createElement('a');
            link.download = `ACN-Solar-${state.name}.jpg`;
            link.href = canvas.toDataURL('image/jpeg', 0.9);
            link.click();
        }
    </script>
</body>
</html>